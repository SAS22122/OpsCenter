graph LR
    %% Styles
    classDef user fill:#e1f5fe,stroke:#0277bd,stroke-width:2px;
    classDef azure fill:#e3f2fd,stroke:#1565c0,stroke-width:2px;
    classDef ai fill:#fff3e0,stroke:#ef6c00,stroke-width:2px;
    classDef core fill:#e8f5e9,stroke:#2e7d32,stroke-width:2px;
    classDef database fill:#e0f2f1,stroke:#00695c,stroke-width:2px;
    classDef external fill:#fce4ec,stroke:#c2185b,stroke-width:2px;

    %% --- 1. SOURCES (INPUT) ---
    subgraph S1 ["1. SENSORS & SOURCES"]
        Apps["Apps MÃ©tier (.NET/Node)"]:::external
        Code["Code Repos (GitHub/Azure)"]:::external
    end

    %% --- 2. INGESTION (HOT/COLD) ---
    subgraph S2 ["2. INGESTION HUB"]
        Hub{{"Azure Event Hubs"}}:::azure
    end

    %% --- 3. INTELLIGENCE (THE BRAIN) ---
    subgraph S3 ["3. AGENTIC INTELLIGENCE"]
        direction TB
        Vector["Azure AI Search (Vector)"]:::ai
        Agent["RCA Agent (Root Cause)"]:::ai
        LLM["Azure OpenAI (GPT-4o)"]:::ai
        
        Vector <--> LLM
        Agent <--> LLM
    end

    %% --- 4. CORE & STATE ---
    subgraph S4 ["4. INCIDENT CORE"]
        State["State Manager (AKS)"]:::core
        DB[("Postgres + Kusto")]:::database
        State <--> DB
    end

    %% --- 5. CONSUMPTION (OUTPUT) ---
    subgraph S5 ["5. MISSION CONTROL"]
        Gateway["API Gateway"]:::azure
        Cockpit["Cockpit UI (React)"]:::user
        Comms["Teams / Alerts"]:::user
    end

    %% --- PIPELINE FLOW ---
    Apps -->|"Logs Stream"| Hub
    Hub -->|"Buffer"| Vector
    
    %% AI Processing
    Vector -->|"New Pattern"| Agent
    Agent -.->|"Read Code"| Code
    Agent -->|"Push RCA"| State
    
    %% User Interaction
    Cockpit <--> Gateway
    Gateway <--> State
    State -->|"Notify"| Comms
    
    %% Legacy Archiving
    Hub -.->|"Raw Archive"| DB
